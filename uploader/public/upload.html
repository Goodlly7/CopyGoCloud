<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>COPYGO</title>
  <style>
    body{margin:0;font-family:Inter,system-ui,sans-serif;background:#fff;color:#0f172a;display:flex;justify-content:center;align-items:center;min-height:100vh}
    .card{width:min(460px,94vw);background:#fff;border:1px solid #e5e7eb;border-radius:20px;box-shadow:0 10px 40px rgba(2,6,23,.06);padding:28px 22px;text-align:center}
    .logo{font-size:44px;font-weight:900;letter-spacing:.4px;margin:0 0 6px}
    .logo span{display:inline-block}
    .c1{color:#ef4444}.c2{color:#f59e0b}.c3{color:#16a34a}.c4{color:#06b6d4}.c5{color:#8b5cf6}.c6{color:#ec4899}
    .subtitle{margin:0 0 18px;color:#64748b;font-size:14px}

    .filebox{display:flex;flex-direction:column;gap:12px;align-items:stretch}
    #picker{position:absolute;left:-9999px}
    .btn{appearance:none;border:0;border-radius:12px;padding:14px 18px;font-weight:800;cursor:pointer;font-size:15px;color:#fff;background:linear-gradient(135deg,#06b6d4,#3b82f6);transition:.2s ease}
    .btn:hover{transform:translateY(-1px);box-shadow:0 8px 22px rgba(59,130,246,.25)}
    .btn.secondary{background:linear-gradient(135deg,#8b5cf6,#ec4899)}
    .btn[disabled]{opacity:.55;cursor:not-allowed;transform:none;box-shadow:none}

    .chosen{font-size:13px;color:#475569;min-height:18px}

    .progress{margin-top:18px;text-align:left;font-size:14px;color:#334155;max-height:320px;overflow:auto}
    .row{margin-top:10px}
    .bar{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin-top:6px}
    .bar i{display:block;height:100%;width:0;background:linear-gradient(90deg,#3b82f6,#06b6d4);transition:width .2s}
    .ok{color:#16a34a;font-weight:600;margin-top:10px}
    .err{color:#ef4444;font-weight:600;margin-top:10px}
    .link{display:inline-block;margin-top:6px;font-size:13px;text-decoration:none;color:#2563eb}
  </style>
</head>
<body>
  <div class="card">
    <h1 class="logo" aria-label="COPYGO">
      <span class="c1">C</span><span class="c2">O</span><span class="c3">P</span><span class="c4">Y</span><span class="c5">G</span><span class="c6">O</span>
    </h1>
    <p class="subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã ‚Äî –ø—Ä–æ—Å—Ç–æ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</p>

    <div class="filebox">
      <input type="file" id="picker" multiple accept="image/*,application/pdf,video/*,application/zip,.7z,.rar" />
      <button class="btn" id="choose">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</button>
      <button class="btn secondary" id="send">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <div class="chosen" id="chosen">–§–∞–π–ª—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã</div>
    </div>

    <div class="progress" id="progress"></div>
  </div>

  <script>
    // üëâ ID –ø–∞–ø–∫–∏ Google Drive (–ü—Ä–∏–µ–º —Ñ–æ—Ç–∫–∏)
    const DRIVE_FOLDER_ID = '14JmmbXxv9Qxcuab9WYRcXZNyiTqV-FVK';

    const picker=document.getElementById('picker');
    const choose=document.getElementById('choose');
    const send=document.getElementById('send');
    const chosen=document.getElementById('chosen');
    const progress=document.getElementById('progress');

    choose.addEventListener('click',()=> picker.click());
    picker.addEventListener('change',()=>{
      if(!picker.files.length){ chosen.textContent='–§–∞–π–ª—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã'; return; }
      const names=[...picker.files].slice(0,3).map(f=>f.name);
      chosen.textContent = picker.files.length>3 ? names.join(', ')+' +' + (picker.files.length-3) : names.join(', ');
    });

    send.addEventListener('click',async()=>{
      if(!picker.files.length){ alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã'); return; }
      lock(true);
      progress.innerHTML='–ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É...';
      try{
        for(const file of picker.files){ await uploadOne(file); }
        progress.innerHTML+='<div class="ok">–ì–æ—Ç–æ–≤–æ ‚úÖ</div>';
        // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø–∞–ø–∫—É
        showFolderLink();
      }finally{
        lock(false);
      }
    });

    function lock(v){ choose.disabled=v; send.disabled=v; picker.disabled=v; }

    function showFolderLink(){
      const a=document.createElement('a');
      a.href=`https://drive.google.com/drive/folders/${DRIVE_FOLDER_ID}`;
      a.target='_blank'; a.rel='noopener noreferrer'; a.className='link';
      a.textContent='–û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É –Ω–∞ –î–∏—Å–∫–µ';
      progress.appendChild(a);
    }

    function uploadOne(file){
      return new Promise((resolve)=>{
        const row=document.createElement('div'); row.className='row'; row.textContent=file.name;
        const bar=document.createElement('div'); bar.className='bar'; const fill=document.createElement('i'); bar.appendChild(fill);
        progress.appendChild(row); progress.appendChild(bar);

        const xhr=new XMLHttpRequest();
        xhr.open('POST','/upload');
        const fd=new FormData(); fd.append('file', file, file.name);

        xhr.upload.onprogress=(e)=>{ if(e.lengthComputable){ fill.style.width=(e.loaded/e.total*100)+'%'; } };

        xhr.onload=()=>{
          try{
            const data = JSON.parse(xhr.responseText||'{}');
            if(data.ok && Array.isArray(data.files)){
              data.files.forEach(f=>{
                if(f.webViewLink){
                  const a=document.createElement('a');
                  a.href=f.webViewLink; a.target='_blank'; a.rel='noopener noreferrer';
                  a.className='link'; a.textContent='–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª –≤ Google Drive';
                  progress.appendChild(a);
                }
              });
            }else if(data && data.error){
              const e=document.createElement('div'); e.className='err'; e.textContent='–û—à–∏–±–∫–∞: '+data.error;
              progress.appendChild(e);
            }
          }catch{}
          resolve();
        };
        xhr.onerror=()=>{ resolve(); };
        xhr.send(fd);
      });
    }
  </script>
</body>
</html>
