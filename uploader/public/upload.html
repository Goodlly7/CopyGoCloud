<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>CopyGo → Google Drive</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:40px;max-width:720px}
    .box{border:1px solid #ddd;border-radius:12px;padding:16px}
    .row{margin:10px 0}
    button{padding:10px 16px;border-radius:10px;border:0;background:#2563eb;color:#fff;cursor:pointer}
    input[type=file]{padding:6px}
    pre{background:#111;color:#b7ffb7;padding:12px;border-radius:10px;overflow:auto}
  </style>
</head>
<body>
  <h1>CopyGo → Google Drive</h1>
  <div class="box">
    <div class="row">
      SID: <input id="sid" style="width:220px" />
      <button id="gen">Новый SID</button>
    </div>
    <div class="row">
      <input id="file" type="file" multiple />
      <button id="send">Загрузить</button>
    </div>
    <pre id="log"></pre>
  </div>

<script>
const $ = (s)=>document.querySelector(s);
const log = (m)=>{ $('#log').textContent += (typeof m==='string'?m:JSON.stringify(m)) + '\n'; };

const sp = new URLSearchParams(location.search);
$('#sid').value = sp.get('sid') || (Date.now().toString());

$('#gen').onclick = () => { $('#sid').value = Date.now().toString(); };

$('#send').onclick = async () => {
  const sid = $('#sid').value.trim();
  const files = $('#file').files;
  if (!sid) return alert('SID пустой');
  if (!files.length) return alert('Выбери файлы');

  for (const f of files) {
    const fd = new FormData();
    fd.append('file', f, f.name);
    try {
      const r = await fetch(`/upload?sid=${encodeURIComponent(sid)}`, {
        method: 'POST',
        body: fd
      });
      if (!r.ok) throw new Error(await r.text());
      const data = await r.json();
      log(`OK: ${f.name}`);
      log(data);
    } catch(e) {
      log(`ERR: ${f.name} -> ${e.message||e}`);
    }
  }
};
</script>
</body>
</html>
